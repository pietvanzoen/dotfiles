#!/bin/bash

set -e

DEFAULT_PIPE_NAME=".plumber"
PIPE_NAME="${1:-$DEFAULT_PIPE_NAME}"
RUNNING=true

if ! mkfifo $PIPE_NAME; then
  echo "Clean up existing pipe before running."
  exit 1
fi

function cleanup() {
  RUNNING=false
  rm $PIPE_NAME
}
trap cleanup SIGINT

set +e
echo "Waiting for commands!"

while $RUNNING; do
  COMMAND=$(cat $PIPE_NAME)
  echo Running ${COMMAND}...
  sh -c "$COMMAND"
done
